---
layout: post
title: "암호화 알고리즘 1. 비대칭키 암호화"
date: 2020-11-13 02:04:00-08:00
---

# 암호화 알고리즘 이해와 사용

## 비대칭키 암호화 (asymmetric crypto) / 공개키 암호화 (public-key crypto)

비대칭키 암호화는 암호화와 복호화에 서로 다른 2개의 키를 사용하기 때문에 비대칭키 암호화라고 부릅니다. 2개의 키를 공개키, 비밀키로 지칭하기에 공개키 암호화라고도 합니다. RSA가 여기에 해당합니다.

### 특징

비대칭키 암호화와 대비되는 대칭키 암호화의 경우는 암/복호화에 하나의 키를 사용합니다. 대칭키 암호화 방식을 이용해서 두사람이 통신하기 위해서는 사전에 비밀키를 공유해야 하나, 이 비밀키를 안전하게 공유하기 위해서는 또 다른 암호화 채널이나 다른이가 볼 수 없는 전혀 별개의 통신 채널이 필요합니다. 하지만 비대칭키 암호화의 경우는 서로 다른 키를 사용하기 때문에 키교환을 비밀리에 할 필요가 없습니다.

### 사용방식

1. 특정 수신자만 볼 수 있도록 암호화.
  1. 수신자가 자신의 비밀키와 공개키를 생성하고, 공개키를 공유합니다. 이 때 비밀키는 누구에게도 보내지 말고 자신만 가지고 있어야 합니다.
  1. 송신자는 수신자의 공개키를 사용해서 메세지를 암호화해서 전송합니다. 이 메세지는 수신자의 비밀키로만 복호화 가능하므로, 비밀키를 가진 수신자만 열어 볼 수 있습니다.
1. 메세지 송신자 인증.
  1. 송신자는 자신의 비밀키와 공개키를 생성하고, 공개키를 공유합니다.
  1. 송신자는 메세지를 자신의 비밀키로 암호화해서 전송합니다.
  1. 메세지가 해당 송신자의 공개키로 복호화 가능하다면, 메세지를 암호화 한 사람은 비밀키를 가진 송신자였음을 확인할 수 있습니다.

위의 2가지 방식을 모두 적용하여, 메세지를 수신자의 공개키로 암호화하고, 그 결과를 다시 송신자의 비밀키로 암호화 할 수 있습니다. 수신측은 먼저 송신자의 공개키로 복호화하여 송신자를 확인하고, 수신자의 비밀키로 복호화하여 수신자만 내용을 읽을 수 있도록 할 수 있습니다.

### 단점

비대칭키 알고리즘은 키 교환의 문제를 해결할 수 있지만, 대칭키 알고리즘에 비해서 키의 크기와 암/복호화 성능에서 단점을 가지고 있습니다.

암호화는 일반적으로 보다 큰 키를 사용할수록 키를 알아내기 어렵기에 더 안전합니다. 하지만 비대칭키 알고리즘은 대칭키 알고리즘에 비해서 더 큰 키를 필요로 합니다. 대칭키 알고리즘의 대표적인 AES의 경우 128 bit로도 충분한 수준의 보안을 제공하고, 256 bit면 최고 기밀 수준의 데이터를 암호화 하기에도 충분합니다. 하지만 비대칭키 알고리즘인 RSA의 경우 일반적인 수준의 보안에도 최소 2048 bit 이상을 권장합니다.

또한 공개키 알고리즘의 경우 대개 소수의 특성을 이용한 방식이기에 계산 과정이 복잡하고, 대칭키 알고리즘에 비하여 암/복호화 속도에서 크게 뒤쳐집니다. 또한 AES를 포함해서 일반적인 대칭키 알고리즘은 지원하는 하드웨어가 많아 속도면에서 더 차이가 크게 납니다.

위의 2가지 단점으로 인해서 공개키 알고리즘은 일반적으로 대칭키 암호화를 위한 키 공유에 사용합니다. 키 교환의 문제가 없는 공개키 알고리즘을 사용하여 두 사람이 대칭키 암호화에 사용될 하나의 비밀키를 공유하고, 이후 실제 데이터 통신은 대칭키 암호화를 사용하여 통신합니다.

### 실제 사례

#### https 통신

공개키 알고리즘이 실제로 가장 널리 쓰이는 것은 인증서와 https 통신입니다. https 통신에서 서버의 인증서는 서버의 공개키에 해당합니다. https 통신을 단순화 시켜보면,
  1. 서버가 자신의 공개키(=인증서)를 클라이언트에 전송합니다.
  1. 클라이언트는 대칭키 암호화에 쓰일 비밀키를 서버의 공개키로 암호화하고 전송합니다.
  1. 서버는 자신의 비밀키로 복호화하여 이후 통신에 쓰일 비밀키를 얻습니다.
  1. 이후는 해당 비밀키와 대칭키 암호화를 사용해서 통신합니다.

#### 인증서 (chain of trust)

서버의 인증서는 서버의 공개키를 포함하여 여러가지 정보를 가지고 있는데, 그 중 한가지는 서버의 인증서를 발급해준 CA(certificate authority)에 대한 정보입니다.

서버의 인증서는 서버의 공개키라는 암호통신을 안전하게 하기 위해서 아주 중요한 정보를 포함하고 있습니다. https 통신이 안전한 것은 서버의 공개키를 사용하여 암호화를 하기에 비밀키를 가진 서버만 메세지를 읽을 수 있기 때문입니다. 만약 클라이언트가 받은 서버의 인증서가 실제 서버의 인증서가 아닌 제 3자의 공개키라면 안전성에 대해서 보장 할 수 없습니다.

그 점을 해결 하기 위해서 인증서에는 발급자의 정보와 발급자의 서명이 들어갑니다. 발급자의 서명이란 특정 데이터를 발급자의 비밀키로 암호화한 데이터로, 이 데이터를 발급자의 공개키로 복호화해서 읽을 수 있다면, 해당 인증서의 발급자를 확인할 수 있습니다. 클라이언트가 해당 발급자를 신뢰하고, 발급자의 공개키를 가지고 있다면, 간접적으로 인증서가 해당 서버의 것임을 신뢰할 수 있습니다.

발급자의 공개키를 모르는 경우에는 발급자의 인증서를 가져올 수 있습니다. 그리고 그 인증서는 또다시 발급자의 인증서를 발급한 기관의 정보를 가집니다. 이런 식으로 계속 인증서가 연결이 될 수 있기에 certificate chain, chain of trust 라고 부릅니다. 이 방식에서 연결고리를 따라가서 최상위 발급기관의 공개키를 가지고 있다면, 연쇄적으로 연결된 모두 인증서를 검증할 수 있게 됩니다. 이런 최상위 발급 기관을 root CA 라고 부르며, 처음 운영체제를 설치할 때, 브라우저를 설치할 때, 클라이언트에 root CA의 인증서가 같이 설치됩니다.


